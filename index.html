<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSort - Ïä§ÎßàÌä∏ Î∂ÑÎ¶¨ÏàòÍ±∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8f9fa; 
            min-height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
        }
        .container { 
            background: white; 
            border-radius: 24px; 
            padding: 50px; 
            max-width: 800px; 
            width: 100%; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.12); 
            border: 1px solid #e9ecef;
        }
        h1 { 
            color: #1a202c; 
            margin-bottom: 40px; 
            text-align: center; 
            font-size: 2.8em; 
            font-weight: 800;
            letter-spacing: -1px;
        }
        h1 .subtitle {
            display: block;
            font-size: 0.4em;
            color: #718096;
            font-weight: 600;
            margin-top: 8px;
            letter-spacing: 0;
        }
        
        /* Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ */
        #loginScreen { text-align: center; padding: 40px 0; }
        #loginScreen p { 
            margin-bottom: 40px; 
            color: #718096; 
            font-size: 1.2em; 
            line-height: 1.6; 
        }
        .login-btn { 
            background: white; 
            color: #1a202c; 
            border: 3px solid #e2e8f0; 
            padding: 20px 50px; 
            border-radius: 16px; 
            font-size: 1.1em; 
            cursor: pointer; 
            width: 100%; 
            max-width: 400px;
            margin: 0 auto;
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px rgba(0,0,0,0.1);
        }
        .login-btn:hover { 
            border-color: #06b6d4; 
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(6, 182, 212, 0.3);
        }
        
        /* ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ */
        .user-info { 
            display: flex; 
            align-items: center; 
            gap: 15px;
            margin-bottom: 30px; 
            padding: 20px 25px; 
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 16px; 
            border: 2px solid #e2e8f0;
        }
        .user-info img { 
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        .user-name { 
            flex: 1; 
            font-weight: 700; 
            color: #1a202c; 
            font-size: 1.1em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .logout-btn { 
            background: #fee2e2; 
            color: #dc2626; 
            border: 2px solid #dc2626; 
            padding: 0; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 1.4em; 
            transition: all 0.2s;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }
        .logout-btn:hover {
            background: #dc2626;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }
        
        /* ÌÉ≠ Î©îÎâ¥ */
        .tabs { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 35px; 
            background: #f7fafc;
            padding: 8px;
            border-radius: 16px;
        }
        .tab { 
            flex: 1; 
            padding: 16px; 
            background: transparent; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 700; 
            font-size: 1.05em;
            transition: all 0.3s;
            color: #718096;
        }
        .tab.active { 
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
            color: white; 
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.25);
        }
        
        .upload-area { 
            border: 4px dashed #cbd5e0; 
            border-radius: 20px; 
            padding: 60px 30px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s; 
            margin-bottom: 25px; 
            background: #f7fafc;
        }
        .upload-area:hover { 
            border-color: #06b6d4; 
            background: linear-gradient(135deg, #f0fdfa 0%, #e0f2fe 100%);
            transform: translateY(-2px);
        }
        .upload-area.drag-over { 
            border-color: #06b6d4; 
            background: linear-gradient(135deg, #cffafe 0%, #bae6fd 100%);
            border-style: solid;
        }
        .upload-area p {
            font-size: 1.3em;
            color: #4a5568;
            font-weight: 600;
            margin: 0;
        }
        input[type="file"] { display: none; }
        button { 
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
            color: white; 
            border: none; 
            padding: 20px 50px; 
            border-radius: 16px; 
            font-size: 1.15em; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 15px; 
            font-weight: 700; 
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.25);
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 30px rgba(6, 182, 212, 0.35);
        }
        button:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        #preview { 
            max-width: 100%; 
            max-height: 500px;
            width: auto;
            height: auto;
            border-radius: 16px; 
            margin: 25px auto; 
            display: none; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            object-fit: contain;
        }
        #result { 
            margin-top: 35px; 
            padding: 35px; 
            background: white;
            border-radius: 20px; 
            display: none; 
            border: 2px solid #e5e7eb;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }
        .result-label { 
            font-size: 2.2em; 
            color: #1f2937; 
            font-weight: 800; 
            margin-bottom: 15px; 
            text-align: center;
        }
        .result-score { 
            color: #2d3748; 
            font-size: 1.4em; 
            font-weight: 600;
            text-align: center;
        }
        .disposal-info {
            margin-top: 20px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            font-size: 1.1em;
            color: #374151;
            line-height: 1.6;
            border-left: 5px solid #06b6d4;
        }
        .spinner { 
            border: 5px solid #e2e8f0; 
            border-top: 5px solid #667eea; 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            animation: spin 0.8s linear infinite; 
            margin: 30px auto; 
            display: none; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        .error { 
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            color: #742a2a; 
            padding: 20px; 
            border-radius: 16px; 
            margin-top: 25px; 
            display: none; 
            font-weight: 600;
            border: 3px solid #fc8181;
            font-size: 1.05em;
        }
        
        /* ÌûàÏä§ÌÜ†Î¶¨ */
        #historyTab { display: none; }
        .history-item { 
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            padding: 25px; 
            border-radius: 16px; 
            margin-bottom: 20px; 
            display: flex; 
            gap: 20px; 
            align-items: center; 
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            border-color: #cbd5e0;
        }
        .history-img { 
            width: 100px; 
            height: 100px; 
            object-fit: cover; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .history-info { flex: 1; }
        .history-label { 
            font-weight: 800; 
            color: #0891b2; 
            font-size: 1.4em; 
            margin-bottom: 8px;
        }
        .history-score {
            color: #4a5568;
            font-size: 1.05em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .history-date { 
            color: #a0aec0; 
            font-size: 0.95em; 
            margin-top: 5px; 
        }
        .no-history { 
            text-align: center; 
            color: #a0aec0; 
            padding: 60px 20px; 
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ôªÔ∏è EcoSort<span class="subtitle">AI Ïä§ÎßàÌä∏ Î∂ÑÎ¶¨ÏàòÍ±∞</span></h1>
        
        <!-- Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ -->
        <div id="loginScreen">
            <p>üåç AIÍ∞Ä Ïì∞Î†àÍ∏∞Î•º ÏûêÎèôÏúºÎ°ú Î∂ÑÎ•òÌïòÍ≥†<br>Ïò¨Î∞îÎ•∏ Î∂ÑÎ¶¨ÏàòÍ±∞ Î∞©Î≤ïÏùÑ ÏïåÎ†§ÎìúÎ†§Ïöî</p>
            <button class="login-btn" id="googleLoginBtn">
                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                GoogleÎ°ú Î°úÍ∑∏Ïù∏
            </button>
        </div>
        
        <!-- Î©îÏù∏ ÌôîÎ©¥ (Î°úÍ∑∏Ïù∏ ÌõÑ) -->
        <div id="mainScreen" style="display: none;">
            <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ -->
            <div class="user-info">
                <img id="userPhoto" src="" alt="User">
                <span class="user-name" id="userName"></span>
                <button class="logout-btn" id="logoutBtn" title="Î°úÍ∑∏ÏïÑÏõÉ">üö™</button>
            </div>
            
            <!-- ÌÉ≠ Î©îÎâ¥ -->
            <div class="tabs">
                <button class="tab active" id="historyTabBtn">ÎÇ¥ Í∏∞Î°ù</button>
                <button class="tab" id="statsTabBtn">ÌÜµÍ≥Ñ</button>
            </div>
            
            <!-- ÌûàÏä§ÌÜ†Î¶¨ ÌÉ≠ -->
            <div id="historyTab">
                <div id="historyList"></div>
            </div>
            
            <!-- ÌÜµÍ≥Ñ ÌÉ≠ -->
            <div id="statsTab" style="display: none;">
                <div id="statsContent"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, query, where, orderBy, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyAntkuWODPMzCr6pBK6HInee9Vrd_Dvdc0",
            authDomain: "garbage-classifier-27697.firebaseapp.com",
            projectId: "garbage-classifier-27697",
            storageBucket: "garbage-classifier-27697.firebasestorage.app",
            messagingSenderId: "1079222481108",
            appId: "1:1079222481108:web:f12b06ef3c20eae856cb41"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const API_URL = 'https://garbage-classifier-16970477973.asia-northeast3.run.app';

        // Î∂ÑÎ•ò ÎùºÎ≤® ÌïúÍ∏Ä Î≤àÏó≠ Î∞è Ï≤òÎ¶¨ Î∞©Î≤ï (ÏÜåÎ¨∏Ïûê ÌÇ§)
        const wasteInfo = {
            'battery': {
                label: 'Î∞∞ÌÑ∞Î¶¨',
                disposal: 'üîã Î∞∞ÌÑ∞Î¶¨: Ï†ÑÏö© ÏàòÍ±∞Ìï®Ïóê Î∞∞Ï∂ú (Ï£ºÎØºÏÑºÌÑ∞, ÎåÄÌòïÎßàÌä∏)'
            },
            'biological': {
                label: 'ÏùåÏãùÎ¨ºÏì∞Î†àÍ∏∞',
                disposal: 'ü•¨ ÏùåÏãùÎ¨º: Î¨ºÍ∏∞ Ï†úÍ±∞ ÌõÑ Ï†ÑÏö© ÏàòÍ±∞Ìï®Ïóê Î∞∞Ï∂ú'
            },
            'cardboard': {
                label: 'Í≥®ÌåêÏßÄ',
                disposal: 'üì¶ Í≥®ÌåêÏßÄ: ÌÖåÏù¥ÌîÑ/ÏÉÅÌëú Ï†úÍ±∞ ÌõÑ Ìé¥ÏÑú Î∞∞Ï∂ú'
            },
            'clothes': {
                label: 'ÏùòÎ•ò',
                disposal: 'üëï ÏùòÎ•ò: Íπ®ÎÅóÏù¥ ÏÑ∏ÌÉÅ ÌõÑ ÏùòÎ•òÏàòÍ±∞Ìï® ÎòêÎäî Ïû¨ÌôúÏö©ÏÑºÌÑ∞'
            },
            'glass': {
                label: 'Ïú†Î¶¨',
                disposal: 'üçæ Ïú†Î¶¨Î≥ë: ÎÇ¥Ïö©Î¨º ÎπÑÏö∞Í≥† ÎöúÍªë Î∂ÑÎ¶¨ ÌõÑ Î∞∞Ï∂ú'
            },
            'metal': {
                label: 'Í∏àÏÜç',
                disposal: 'ü•´ Ï∫îÎ•ò: ÎÇ¥Ïö©Î¨º Ï†úÍ±∞ ÌõÑ ÏïïÏ∞©ÌïòÏó¨ Î∞∞Ï∂ú'
            },
            'paper': {
                label: 'Ï¢ÖÏù¥',
                disposal: 'üìÑ Ï¢ÖÏù¥Î•ò: ÎπÑÎãê/Ï≤†Ïã¨ Ï†úÍ±∞ ÌõÑ Î∞∞Ï∂ú'
            },
            'plastic': {
                label: 'ÌîåÎùºÏä§Ìã±',
                disposal: '‚ôªÔ∏è ÌîåÎùºÏä§Ìã±: ÎùºÎ≤® Ï†úÍ±∞, Íπ®ÎÅóÏù¥ ÏîªÏñ¥ÏÑú Î∞∞Ï∂ú'
            },
            'shoes': {
                label: 'Ïã†Î∞ú',
                disposal: 'üëü Ïã†Î∞ú: Ïû¨ÌôúÏö©ÏÑºÌÑ∞ ÎòêÎäî ÏùòÎ•òÏàòÍ±∞Ìï®Ïóê Î∞∞Ï∂ú'
            },
            'trash': {
                label: 'ÏùºÎ∞òÏì∞Î†àÍ∏∞',
                disposal: 'üóëÔ∏è ÏùºÎ∞òÏì∞Î†àÍ∏∞: Ï¢ÖÎüâÏ†úÎ¥âÌà¨Ïóê Î∞∞Ï∂ú'
            }
        };

        // DOM ÏöîÏÜå
        const loginScreen = document.getElementById('loginScreen');
        const mainScreen = document.getElementById('mainScreen');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userName = document.getElementById('userName');
        const userPhoto = document.getElementById('userPhoto');
        
        const historyTabBtn = document.getElementById('historyTabBtn');
        const statsTabBtn = document.getElementById('statsTabBtn');
        const historyTab = document.getElementById('historyTab');
        const statsTab = document.getElementById('statsTab');
        
        const historyList = document.getElementById('historyList');
        const statsContent = document.getElementById('statsContent');

        let currentUser = null;

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Í∞êÏßÄ
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                userName.textContent = user.displayName;
                userPhoto.src = user.photoURL;
                loginScreen.style.display = 'none';
                mainScreen.style.display = 'block';
                loadHistory();
            } else {
                currentUser = null;
                loginScreen.style.display = 'block';
                mainScreen.style.display = 'none';
            }
        });

        // Google Î°úÍ∑∏Ïù∏
        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert('Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ' + error.message);
            }
        });

        // Î°úÍ∑∏ÏïÑÏõÉ
        logoutBtn.addEventListener('click', () => {
            signOut(auth);
        });

        // ÌÉ≠ Ï†ÑÌôò
        historyTabBtn.addEventListener('click', () => {
            historyTabBtn.classList.add('active');
            statsTabBtn.classList.remove('active');
            historyTab.style.display = 'block';
            statsTab.style.display = 'none';
            loadHistory();
        });
        
        statsTabBtn.addEventListener('click', () => {
            statsTabBtn.classList.add('active');
            historyTabBtn.classList.remove('active');
            statsTab.style.display = 'block';
            historyTab.style.display = 'none';
            loadStats();
        });

        // ÌûàÏä§ÌÜ†Î¶¨ Î°úÎìú
        async function loadHistory() {
            if (!currentUser) return;
            
            historyList.innerHTML = '<div class="spinner" style="display: block;"></div>';
            
            try {
                const q = query(
                    collection(db, 'classifications'),
                    where('userId', '==', currentUser.uid),
                    orderBy('timestamp', 'desc')
                );
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    historyList.innerHTML = '<div class="no-history">Î∂ÑÏÑù Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</div>';
                    return;
                }
                
                historyList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <img src="${data.imageUrl}" class="history-img" alt="Î∂ÑÎ•ò Ïù¥ÎØ∏ÏßÄ">
                        <div class="history-info">
                            <div class="history-label">${data.label}</div>
                            <div class="history-score">Ï†ïÌôïÎèÑ ${(data.score * 100).toFixed(1)}%</div>
                            <div class="history-date">${new Date(data.timestamp.seconds * 1000).toLocaleString('ko-KR')}</div>
                        </div>
                    `;
                    historyList.appendChild(item);
                });
            } catch (error) {
                historyList.innerHTML = `<div class="error" style="display: block;">Í∏∞Î°ù Î°úÎìú Ïã§Ìå®: ${error.message}</div>`;
            }
        }
        
        // ÌÜµÍ≥Ñ Î°úÎìú
        async function loadStats() {
            if (!currentUser) return;
            
            statsContent.innerHTML = '<div class="spinner" style="display: block;"></div>';
            
            try {
                const q = query(
                    collection(db, 'classifications'),
                    where('userId', '==', currentUser.uid)
                );
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    statsContent.innerHTML = '<div class="no-history">ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</div>';
                    return;
                }
                
                // ÌÜµÍ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
                const stats = {};
                let totalCount = 0;
                let totalScore = 0;
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    totalCount++;
                    totalScore += data.score;
                    
                    if (stats[data.label]) {
                        stats[data.label]++;
                    } else {
                        stats[data.label] = 1;
                    }
                });
                
                // ÌÜµÍ≥Ñ Ï†ïÎ†¨ (ÎßéÏù¥ Î∂ÑÎ•òÌïú Ïàú)
                const sortedStats = Object.entries(stats).sort((a, b) => b[1] - a[1]);
                
                // ÌÜµÍ≥Ñ HTML ÏÉùÏÑ±
                let statsHTML = `
                    <div style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 30px; border-radius: 16px; margin-bottom: 25px; border: 2px solid #e2e8f0;">
                        <h2 style="color: #1a202c; margin-bottom: 20px; font-size: 1.8em;">üìä ÎÇòÏùò Î∂ÑÎ•ò ÌÜµÍ≥Ñ</h2>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5em; font-weight: 800; color: #667eea;">${totalCount}</div>
                                <div style="color: #718096; margin-top: 8px; font-weight: 600;">Ï¥ù Î∂ÑÎ•ò ÌöüÏàò</div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; text-align: center;">
                                <div style="font-size: 2.5em; font-weight: 800; color: #48bb78;">${(totalScore / totalCount * 100).toFixed(1)}%</div>
                                <div style="color: #718096; margin-top: 8px; font-weight: 600;">ÌèâÍ∑† Ï†ïÌôïÎèÑ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 30px; border-radius: 16px; border: 2px solid #e2e8f0;">
                        <h3 style="color: #1a202c; margin-bottom: 20px; font-size: 1.4em;">üèÜ Î∂ÑÎ•ò ÏàúÏúÑ</h3>
                `;
                
                sortedStats.forEach(([label, count], index) => {
                    const percentage = (count / totalCount * 100).toFixed(1);
                    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üìå';
                    
                    statsHTML += `
                        <div style="margin-bottom: 15px; padding: 15px; background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%); border-radius: 12px; border-left: 4px solid #667eea;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 1.5em;">${medal}</span>
                                    <span style="font-weight: 700; font-size: 1.2em; color: #2d3748;">${label}</span>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 1.4em; font-weight: 800; color: #667eea;">${count}Ìöå</div>
                                    <div style="font-size: 0.9em; color: #a0aec0;">${percentage}%</div>
                                </div>
                            </div>
                            <div style="margin-top: 10px; background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; width: ${percentage}%; transition: width 0.5s;"></div>
                            </div>
                        </div>
                    `;
                });
                
                statsHTML += `
                    </div>
                    
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%); border-radius: 16px; text-align: center; border: 2px solid #81e6d9;">
                        <div style="font-size: 1.1em; color: #234e52; font-weight: 600;">
                            üå± ÏßÄÍ∏àÍπåÏßÄ ${totalCount}Í∞úÏùò Ïì∞Î†àÍ∏∞Î•º Ïò¨Î∞îÎ•¥Í≤å Î∂ÑÎ•òÌñàÏñ¥Ïöî!
                        </div>
                    </div>
                `;
                
                statsContent.innerHTML = statsHTML;
            } catch (error) {
                statsContent.innerHTML = `<div class="error" style="display: block;">ÌÜµÍ≥Ñ Î°úÎìú Ïã§Ìå®: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>